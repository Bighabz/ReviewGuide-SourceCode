---
import { type CollectionEntry, getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import ProductCard from '../../components/ProductCard.astro';

export async function getStaticPaths() {
	const posts = await getCollection('blog');
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: post,
	}));
}
type Props = CollectionEntry<'blog'>;

const post = Astro.props;
const { Content } = await post.render();

const schema = {
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": post.data.title,
  "description": post.data.description,
  "image": post.data.heroImage,
  "datePublished": post.data.pubDate.toISOString(),
  "author": {
    "@type": "Organization",
    "name": "ReviewGuide.ai"
  }
};
---

<Layout title={post.data.title} description={post.data.description} image={post.data.heroImage}>
    <script type="application/ld+json" set:html={JSON.stringify(schema)} />

    <article class="max-w-3xl mx-auto py-12 px-4">
        {post.data.heroImage && <img width={1020} height={510} src={post.data.heroImage} alt={post.data.title} class="rounded-xl shadow-lg mb-8 w-full object-cover" />}
        <div class="prose prose-slate prose-lg mx-auto">
            <div class="mb-8 text-center">
                <div class="text-sm font-bold text-blue-600 uppercase tracking-wide mb-2">{post.data.category}</div>
                <h1 class="text-4xl md:text-5xl font-bold mb-4">{post.data.title}</h1>
                <div class="text-slate-500">
                    <time datetime={post.data.pubDate.toISOString()}>
                        {post.data.pubDate.toLocaleDateString('en-us', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                        })}
                    </time>
                </div>
            </div>
            <hr class="my-8 border-slate-200" />
            <Content components={{ ProductCard }} />
        </div>
    </article>
</Layout>
