# Application
APP_NAME=ReviewGuide.ai
ENV=development
DEBUG=True
SECRET_KEY=your-secret-key-here-change-in-production
API_V1_PREFIX=/v1

# CORS
CORS_ORIGINS=["http://localhost:3000","http://127.0.0.1:3000"]

# Admin Credentials
ADMIN_USERNAME=admin
ADMIN_PASSWORD=changeme123

# Database
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/reviewguide
DB_POOL_SIZE=50
DB_MAX_OVERFLOW=50
DB_POOL_RECYCLE=3600
DB_CONNECT_TIMEOUT=10

# Redis
REDIS_URL=redis://localhost:6379/0
REDIS_MAX_CONNECTIONS=50
REDIS_RETRY_MAX_ATTEMPTS=3
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_HEALTH_CHECK_INTERVAL=30
REDIS_RETRY_BACKOFF_BASE=0.1
ENABLE_SEARCH_CACHE=true

# Conversation History Configuration
# Use Redis cache for history (true) or load directly from PostgreSQL (false)
# - true: Fast Redis cache with PostgreSQL fallback (Production)
# - false: Load directly from PostgreSQL, skip Redis (Dev/Debugging)
USE_REDIS_FOR_HISTORY=true
# Maximum number of recent messages to load and send to LLM for context (recommended: 5-20)
MAX_HISTORY_MESSAGES=10
# Number of user messages from history to include when extracting slots in clarifier agent
MAX_USER_HISTORY_FOR_SLOT_EXTRACTION=5

# Rate Limiting Configuration
# Enable rate limiting for chat endpoint
RATE_LIMIT_ENABLED=true
# Guest users (no authentication) - requests per window
RATE_LIMIT_GUEST_REQUESTS=10
# Guest users - time window in seconds (3600 = 1 hour)
RATE_LIMIT_GUEST_WINDOW=3600
# Authenticated users - requests per window
RATE_LIMIT_AUTH_REQUESTS=100
# Authenticated users - time window in seconds (3600 = 1 hour)
RATE_LIMIT_AUTH_WINDOW=3600

# LLM Providers
OPENAI_API_KEY=sk-your-openai-key-here
ANTHROPIC_API_KEY=sk-ant-your-anthropic-key-here
DEFAULT_MODEL=gpt-4o-mini
LITELLM_LOG_LEVEL=INFO

# Agent-specific Models (override DEFAULT_MODEL for specific agents)
PLANNER_MODEL=o3-mini
INTENT_MODEL=gpt-4o-mini
CLARIFIER_MODEL=gpt-4o-mini
COMPOSER_MODEL=gpt-4o-mini

# Search Provider Configuration
# Options: openai, perplexity, tavily
SEARCH_PROVIDER=openai

# OpenAI Search Provider (currently active)
# Note: Uses the same OPENAI_API_KEY from LLM Providers section above
# Note: Uses DEFAULT_MODEL for the search model
OPENAI_SEARCH_BASE_URL=https://api.openai.com/v1
OPENAI_SEARCH_TIMEOUT=30.0
OPENAI_PRODUCT_DOMAINS=amazon.com,ebay.com,walmart.com
OPENAI_SERVICE_DOMAINS=g2.com,capterra.com,trustpilot.com
OPENAI_TRAVEL_DOMAINS=tripadvisor.com,lonelyplanet.com,booking.com

# Perplexity Search Provider (disabled)
PERPLEXITY_API_KEY=pplx-your-perplexity-key-here
PERPLEXITY_BASE_URL=https://api.perplexity.ai
PERPLEXITY_MODEL=sonar
PERPLEXITY_TIMEOUT=30.0

# Search Domain Filters (comma-separated)
PERPLEXITY_PRODUCT_DOMAINS=ebay.com
PERPLEXITY_SERVICE_DOMAINS=g2.com,capterra.com,trustpilot.com
PERPLEXITY_TRAVEL_DOMAINS=tripadvisor.com,lonelyplanet.com

# Search Query Generation Configuration
# Enable LLM-based search query generation (recommended: false for faster queries)
ENABLE_LLM_SEARCH_QUERY=false
# Suffix to append to product search queries when ENABLE_LLM_SEARCH_QUERY=false
# This helps filter out non-purchasable content from search results
SEARCH_QUERY_PRODUCT_SUFFIX=no articles, blogs, news, reviews, shop. search only purchasable products with title, price, url

# eBay Partner Network (Phase 1)
EBAY_APP_ID=your-ebay-app-id
EBAY_CERT_ID=your-ebay-cert-id
EBAY_CAMPAIGN_ID=your-ebay-campaign-id
EBAY_AFFILIATE_CUSTOM_ID=
EBAY_MKCID=1
EBAY_MKRID=711-53200-19255-0
EBAY_TOOLID=10001
EBAY_MKEVT=1
USE_MOCK_AFFILIATE=True

# Amazon Associates / Product Advertising API
# Set AMAZON_API_ENABLED=true when you have PA-API access (requires 3 sales first)
# Until then, mock data with real ASINs will be used (affiliate links still work)
AMAZON_API_ENABLED=false
AMAZON_ACCESS_KEY=
AMAZON_SECRET_KEY=
# Default associate tag (used if country-specific tag not found)
AMAZON_ASSOCIATE_TAG=yoursite-20
# Country-specific associate tags (format: COUNTRY_CODE:tag,COUNTRY_CODE:tag)
# You may need separate Amazon Associates accounts per region
AMAZON_ASSOCIATE_TAGS=US:yoursite-20,UK:yoursite-21,DE:yoursite-21,CA:yoursite-20
# Default country code when not provided by frontend
AMAZON_DEFAULT_COUNTRY=US

# IP Geolocation (for country detection)
# IPInfo.io Token (Free: 50,000 requests/month)
# Get your free token at: https://ipinfo.io/signup
# Optional: Works without token but with lower rate limit (1,000 requests/day)
IPINFO_TOKEN=

# Affiliate Links Display Configuration
# Set to true to include detailed affiliate links per product in responses
# Set to false to hide them (only first affiliate link shown in product carousel)
SHOW_AFFILIATE_LINKS_PER_PRODUCT=false

# Travel APIs - Hotels
# Booking.com API via RapidAPI (https://rapidapi.com/apidojo/api/booking)
BOOKING_API_KEY=your-rapidapi-key-here
BOOKING_AFFILIATE_ID=

# Travel APIs - Flights
# Skyscanner API via RapidAPI (https://rapidapi.com/skyscanner/api/skyscanner-flight-search)
SKYSCANNER_API_KEY=your-rapidapi-key-here

# Travel APIs - Future Providers (Not Yet Enabled)
# Expedia API (https://developers.expediagroup.com/)
EXPEDIA_API_KEY=
# Amadeus API (https://developers.amadeus.com/)
AMADEUS_API_KEY=
AMADEUS_API_SECRET=

# Travel Provider Selection
# Comma-separated list of providers to use (e.g., "mock", "booking", "expedia")
# Available hotel providers: mock, booking, expedia
# Available flight providers: mock, skyscanner, amadeus
TRAVEL_HOTEL_PROVIDERS=mock
TRAVEL_FLIGHT_PROVIDERS=mock

# Travel Provider Toggle (Legacy - Use TRAVEL_*_PROVIDERS instead)
# Set to False to use real travel APIs (requires API keys above)
# Set to True to use mock data for testing
USE_MOCK_TRAVEL=True

# Travel Cache Configuration
# Enable/disable Redis caching for travel search results
ENABLE_TRAVEL_CACHE=true
# Cache TTL in seconds (default: 3600 = 1 hour)
TRAVEL_CACHE_TTL=3600

# Airport Code Cache Configuration
# Enable/disable database caching for city -> airport code lookups (saves ~7s per flight search)
ENABLE_AIRPORT_CACHE=true
# Cache expiration in days (default: 180 = 6 months)
AIRPORT_CACHE_EXPIRY_DAYS=180

# Link Health Monitoring
# Enable/disable automatic link health checks in background
ENABLE_LINK_HEALTH_CHECKER=true
# Interval in hours between automatic health checks (default: 6 hours)
LINK_HEALTH_CHECK_INTERVAL_HOURS=6
# Timeout in seconds for each link check request (default: 10 seconds)
LINK_HEALTH_CHECK_TIMEOUT=10
# Maximum concurrent link checks (default: 10, increase for faster checks)
LINK_HEALTH_CHECK_MAX_CONCURRENT=10

# Logging Configuration
# Enable/disable all logging in the application
LOG_ENABLED=true
# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO
# Log format: json (production) or colored (development)
LOG_FORMAT=colored

# Observability
LANGFUSE_PUBLIC_KEY=pk-lf-your-public-key
LANGFUSE_SECRET_KEY=sk-lf-your-secret-key
LANGFUSE_HOST=https://cloud.langfuse.com
LANGFUSE_OTLP_ENDPOINT=/api/public/otel
ENABLE_TRACING=True
ENABLE_OPENTELEMETRY_EXPORT=True

# OpenTelemetry Batch Processing Configuration
# Controls how telemetry data is sent to Langfuse in the background
# Batching ensures telemetry export happens AFTER response is sent to user
OTEL_BATCH_SCHEDULE_DELAY_MILLIS=5000        # Wait 5s after request before sending telemetry
OTEL_BATCH_MAX_QUEUE_SIZE=2048                # Max spans to hold in memory
OTEL_BATCH_MAX_EXPORT_BATCH_SIZE=512         # Max spans per HTTP request to Langfuse
OTEL_BATCH_EXPORT_TIMEOUT_MILLIS=30000       # Timeout for export operation (30s)

# Rate Limiting
RATE_LIMIT_PER_IP=100
RATE_LIMIT_PER_SESSION=20

# Anonymous User Configuration
# Pattern: {ANONYMOUS_EMAIL_PREFIX}{random_chars}{ANONYMOUS_EMAIL_DOMAIN}
# Example with defaults: anonymous_a1b2c3d4e5f6g7h8@reviewguide.ai
ANONYMOUS_EMAIL_DOMAIN=@reviewguide.ai
ANONYMOUS_EMAIL_PREFIX=anonymous_
ANONYMOUS_EMAIL_RANDOM_LENGTH=16

# Application Server Configuration
APP_HOST=0.0.0.0
APP_PORT=8000

# Provider Result Limits
EBAY_MAX_RESULTS=50
AMADEUS_MAX_HOTEL_RESULTS=50
AMADEUS_MAX_HOTELS_PER_REQUEST=5
AMADEUS_MAX_HOTELS_TO_RETURN=10
AMADEUS_MAX_FLIGHT_RESULTS=10
BOOKING_MAX_RESULTS=10
SKYSCANNER_MAX_RESULTS=10

# Provider Timeouts and Delays
SKYSCANNER_POLLING_DELAY=2
CHAT_EVENT_QUEUE_TIMEOUT=0.1
CHAT_STREAM_SLEEP_DELAY=0.01

# Cache TTLs (in seconds)
HALT_STATE_TTL=3600
CHAT_HISTORY_CACHE_TTL=3600
